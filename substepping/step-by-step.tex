\begin{frame}
  \frametitle{Substepping workflow}
  \begin{minipage}[t]{0.48\textwidth}
    \begin{figure}
      \centering
      \def\svgwidth{0.4\paperwidth}
      \only<1>{\import{./figures/ss_robin/schematic_partition_tn/}{original.pdf_tex}}
      \only<2->{
        \hspace{-1mm}
        \import{./figures/ss_robin/schematic_partition_tn/}{drawing.pdf_tex}
      }
      \caption{
        \only<1>{Temperature field at time $t^n$, \enskip $T^n$.}
        \only<2->{Partitioned domain $\Omega = \Omega_f \sqcup \Omega_s, \enskip \partial \Omega_f \cap \partial \Omega_s = \Gamma$.}
      }
    \end{figure}
  \end{minipage}%
  \hfill
  \begin{minipage}[t]{0.5\textwidth}
    \only<1>{Let's go over the substepping workflow step by step!}
    \only<2->{
      The solution is advanced to $t^{n+1} = t^n + \Delta t_s$
      via a \textbf{substepping cycle}.

      $\Delta t_s$ is subdivided into $M$ substeps
      \[
      \Delta t_f = \frac{\Delta t_s}{M}, \enskip 
      \]
      defining the intermediate times
      \begin{gather*}
      t^{n+\frac{m}{M}} = t^n + m\,\Delta t_f,
      \qquad m = 1,\dots,M.\\[6pt]
      T_f^{i, n+\frac{m}{M}}, \enskip  T_s^{i, n+\frac{m}{M}}
      \end{gather*}
      denote the fast and slow solutions at time $t^{n+\frac{m}{M}}$ for the $i$-th substepping iteration.

      Within a single time-step $[t^n,t^{n+1}]$, the full substepping cycle
      may be repeated(!).
    }
  \end{minipage}
  
\end{frame}

\input{plots/substepping_pseudo_code.tex}

\begin{frame}
  \frametitle{Substepping workflow}
    \InsertAlgorithmNode{nohl}{0.0}{0.0}
\end{frame}

\begin{frame}
  \frametitle{Substepping workflow}
  \framesubtitle{Predictor}
    \InsertAlgorithmNode{hlpred}{0.0}{-0.6}
\end{frame}

\begin{frame}
  \frametitle{Substepping workflow}
  \framesubtitle{Predictor}
  \begin{figure}
    \centering
    \includegraphics[height=0.6\pageheight]{{ss_robin/predictor.png}}
    \caption{$\tilde{T}^{n+1}$ after predictor step}
    \label{fig:robin_predictor}
    \caption{Predictor step, same for both substeppers.}
  \end{figure}
\end{frame}

\begin{frame}
  \frametitle{Substepping workflow}
  \framesubtitle{Micro-step}
    \InsertAlgorithmNode{hlmicro}{-2.6}{-4.0}
\end{frame}

\begin{frame}
  \frametitle{Substepping workflow}
  \framesubtitle{Micro-step}
  \begin{figure}
  \begin{subfigure}[t]{0.48\textwidth}
    \centering
    \includegraphics[height=0.6\pageheight]{{ss_robin/micro_step.png}}
    \caption{\textbf{Robin}.}
    \label{fig:robin_substep}
  \end{subfigure}%
  \hfill%
  \begin{subfigure}[t]{0.48\textwidth}
    \centering
    \includegraphics[height=0.6\pageheight]{{hodge/micro_step.png}};
    \caption{\textbf{Dirichlet}.}
    \label{fig:hodge_substep}
  \end{subfigure}
  \caption{Robin and Dirichlet substeps.}
  \end{figure}
\end{frame}

\begin{frame}
  \frametitle{Substepping workflow}
  \framesubtitle{Macro-step}
    \InsertAlgorithmNode{hlmacro}{-4.0}{-5.0}
\end{frame}

\begin{frame}
  \frametitle{Substepping workflow}
  \framesubtitle{Macro-step}
  \begin{figure}
  \begin{subfigure}[t]{0.48\textwidth}
    \centering
    \begin{tikzpicture}[
        spy using outlines= {connect spies}
      ]
      \node[anchor=south west, inner sep=0] (A) {\includegraphics[height=0.6\pageheight]{{ss_robin/macro_step.png}}};
    \begin{scope}[x={(A.south east)},y={(A.north west)}]
      % Rectangle highlight (coordinates between 0 and 1)
      %\draw[teal!20, step=0.05] (0,0) grid (1,1);%grid, comment out for draft
      % unhide at second overlay
      \only<2->{
        \draw[red, thick, dash pattern=on 1pt off 1pt] (0.286, 0.5475) circle (0.02);
        \draw[red, thick, dash pattern=on 1pt off 1pt] (0.286, 0.6385) circle (0.02);

        \coordinate (spypointrobinex) at (0.286, 0.62);
        \coordinate (magnifyglassrobinex) at (0.9, 0.5);
        \spy[overlay, black, width=1cm, height=2cm, magnification=2] on (spypointrobinex) in node[fill=white] at (magnifyglassrobinex);
      }
      
    \end{scope}
    \end{tikzpicture}
    \caption{\textbf{Robin} corrector step.}
    \label{fig:robin_corrector}
  \end{subfigure}
  \hfill%
  \begin{subfigure}[t]{0.48\textwidth}
    \centering
    \begin{tikzpicture}
      \node[anchor=south west, inner sep=0] (A) {\includegraphics[height=0.6\pageheight]{{hodge/macro_step.png}}};
      \only<2->{
        \begin{scope}[x={(A.south east)},y={(A.north west)}]
          % Rectangle highlight (coordinates between 0 and 1)
          %\draw[teal!20, step=0.01] (0,0) grid (1,1);%grid, comment out for draft
            \draw[red, thick, dash pattern=on 1pt off 1pt, rounded corners] (0.065, 0.4550) rectangle (0.1905, 0.4905);
            \draw[red, thick, dash pattern=on 1pt off 1pt, rounded corners] (0.2600, 0.5605) rectangle (0.3000, 0.7000);
        \end{scope}
      }
    \end{tikzpicture}
    \caption{\textbf{Dirichlet} corrector step.}
    \label{fig:hodge_corrector}
  \end{subfigure}
  \caption{Robin and Dirichlet corrector steps.}
  \end{figure}
\end{frame}

\begin{frame}
  \frametitle{Substepping}
  \framesubtitle{No heat source predictor}

  Accuracy of Dirichlet substepper is improved by \textbf{exclusion of source
  term from predictor}: note the absence of the heat spots.
  \begin{figure}
    \begin{subfigure}[t]{0.33\textwidth}
      \centering
      \includegraphics[width=\textwidth]{hodge/to_predictor.png}
      \caption{Predictor step without heat input}
      \label{fig:to_hodge_predictor}
    \end{subfigure}%
    \hfill
    \begin{subfigure}[t]{0.33\textwidth}
      \centering
      \includegraphics[width=\textwidth]{hodge/to_micro_step.png}
      \caption{Micro-step.}
      \label{fig:to_hodge_micro}
    \end{subfigure}%
    \hfill
    \begin{subfigure}[t]{0.33\textwidth}
      \centering
      \includegraphics[width=\textwidth]{hodge/to_macro_step.png}
      \caption{Corrector step.}
      \label{fig:to_hodge_macro}
    \end{subfigure}
    \caption{Dirichlet substepper with no-heating predictor.}
    \label{fig:to_hodge}
  \end{figure}
\end{frame}
